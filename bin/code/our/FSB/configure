#!/bin/sh
rm -f *o genmatrix
HASHLEN=$1
cat > Makefile << EOF
CFLAGS:= -Wall -Wextra -Werror -pedantic -ansi -std=c99 -O3

fsb: fsb.o matrix.o whirlpool.o
	gcc \$+ -o \$@

genmatrix: genmatrix.o ../pi.o
	gcc \$+ -o \$@

matrix.c: genmatrix
	./genmatrix > matrix.c

whirlpool.o: whirlpool.c
	gcc -O3 -c \$< -o \$@
	
%.o: %.c params.h
	gcc \${CFLAGS} -Dhashlen=$HASHLEN -c \$< -o \$@

clean:
	rm -f *.o fsb fsb.o genmatrix Makefile matrix.c
EOF
