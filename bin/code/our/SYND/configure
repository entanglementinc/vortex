#!/bin/bash
rm -f *o genmatrix f1.c f2.c
KEY=$1
cat > Makefile << EOF
CFLAGS := -Wall -Wextra -Werror -pedantic -ansi -std=c99 -O3

synd: synd.o f1.o f2.o
	gcc \$+ -o \$@

genmatrix: genmatrix.o ../pi.o
	gcc \$+ -o \$@

f1.c f2.c: genmatrix
	./genmatrix F1 > f1.c
	./genmatrix F2 > f2.c

%.o: %.c
	gcc \${CFLAGS} -Dkeylen=$KEY -c $< -o \$@

clean:
	rm -f *.o f1.c f2.c genmatrix Makefile synd
EOF
