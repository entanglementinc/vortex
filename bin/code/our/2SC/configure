#!/bin/bash
rm -f *o genmatrix f1.c f2.c
KEY=$1
cat > Makefile << EOF
CFLAGS := -Wall -Wextra -Werror -pedantic -ansi -std=c99 -O3

2sc: 2sc.o h1.o h2.o
	gcc \$+ -o \$@

genmatrix: genmatrix.o ../pi.o
	gcc \$+ -o \$@

h1.c h2.c: genmatrix
	./genmatrix H1 > h1.c
	./genmatrix H2 > h2.c

%.o: %.c
	gcc \${CFLAGS} -Dkeylen=$KEY -c $< -o \$@

clean:
	rm -f *o 2sc genmatrix h1.c h2.c Makefile
EOF
